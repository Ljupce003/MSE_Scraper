<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Македонска берза - техничка анализа</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <!--    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>-->
</head>
<body>
<header>
  <div>
    <img src="/images/logo.png" width="70px" height="60px">
    <h1>МАКЕДОНСКА БЕРЗА</h1>
  </div>
  <menu>
    <ul>
      <li><a href="/index">Почетна</a></li>
      <li><a href="/tech_analysis">Техничка анализа</a></li>
      <li class="active">
        <a href="/fundamental">Фундаментална анализа</a>
      </li>
      <li><a href="/lstm">LSTM</a></li>
    </ul>
  </menu>
</header>

<section id="tech">
  <center>
    <input type="hidden" name="haveError" th:value="${error}!=null ? false : true ">

    <div th:text="${error}!=null ? ${error} : ''" >Greski se prikazuvat ovde</div>
    <div th:text="${analysis_error}!=null ? ${analysis_error} : ''" >Greski se prikazuvat ovde</div>

    <form action="/fundamental" method="POST">
      <select name="code" id="stockDropdown">
        <option value="">Одбери акција</option>
        <option  th:each="sifra : ${codes_dropdown}" th:text="${sifra}" th:value="${sifra}"></option>
      </select>

      <input type="submit" value="Submit">
    </form>
    <br />

  </center>
  <div id="result-container" style="display: flex;
    width: 100%;
    flex-direction: column;
    align-items: center;" th:if="${issuer != null}" >
    <h3 th:text="${issuer.getTitle()}"></h3>
    <br>
    <table style="width: 90%; text-align: center;
         border-spacing: 0;overflow: hidden;border-radius: 25px;padding: 0">
      <thead>
      <tr>
        <th>Title</th>
        <th>Link</th>
        <th>Publication Date</th>
      </tr>
      </thead>
      <tbody>
      <!-- Iterate over the RSS items -->
      <tr th:each="rss : ${issuer.rss_items}">
        <td th:text="${rss.title}"></td>
        <td>
          <a th:href="${rss.link}" th:text="${rss.link}" target="_blank"></a>
        </td>
        <td th:text="${rss.pub_date}"></td>
      </tr>
      </tbody>
    </table>
    <br>
    <h2> The result of the processing of these news is <br>
      <span id="res_span" th:text="${issuer.result}"></span> with precision <span th:text="${issuer.score}"></span>
    </h2>
    <br>
  </div>
</section>
<script>
  function setResultColor() {
    let span_element = document.getElementById("res_span");

    if (span_element) {
      let text = span_element.textContent.trim().toLowerCase();

      if (text === "negative") {
        span_element.style.color = "red";
      } else if (text === "positive") {
        span_element.style.color = "green";
      } else {
        span_element.style.color = "black"; // Default color
      }
    }
  }

  setResultColor()

  window.onload = function() {
    // Check if the result-container div is loaded
    let resultContainer = document.getElementById("result-container");
    if (resultContainer) {
      // If the div is loaded, set the height of the section to 'auto'
      let section = document.getElementById("tech");
      if (section) {
        section.style.height = "auto"; // Set height to auto
      }
    }
  }

</script>
<!--    <script>-->
<!--      -->
<!--      let positive = document.getElementById("positive").style.display="none";-->
<!--      let negative = document.getElementById("negative").style.display="none";-->

<!--      document.getElementById("stockDropdown").addEventListener("change", function () {-->
<!--        let none = document.getElementById("none");-->
<!--        let positive = document.getElementById("positive");-->
<!--        let negative = document.getElementById("negative");-->

<!--        none.style.display = "none";-->
<!--        positive.style.display = "none";-->
<!--        negative.style.display = "none";-->

<!--        if (this.value) {-->
<!--          const isPositive = Math.random() < 0.5;-->
<!--          const isNegative = Math.random() < 1;-->

<!--          if (isPositive) {-->
<!--            positive.style.display = "inline"; // Show "КУПИ"-->
<!--            positive.style.color = "#0bca44"-->
<!--          } else if(isNegative) {-->
<!--            negative.style.display = "inline"; // Show "ПРОДАДИ"-->
<!--            negative.style.color = "red"-->
<!--          }-->
<!--        } else {-->
<!--          none.style.display = "inline";-->
<!--          none.style.color = "#000"-->
<!--        }-->
<!--      });-->

<!--    </script>-->
<!--    <script src="/js/chart.js"></script>-->

<!--    <script th:inline="javascript">-->
<!--      // Thymeleaf ќе го вметне JSON-от како стринг-->
<!--      const csvData = /*[[${csvData}]]*/ '[]';-->
<!--      console.log("CSV Data:", csvData); // Провери во конзолата дали податокот е правилно пренесен-->

<!--      // Парсирај го JSON-от-->
<!--      const parsedData = JSON.parse(csvData);-->
<!--      console.log("Parsed Data:", parsedData);-->

<!--      // Потоа продолжи со обработката-->
<!--      const filteredData = filterDataByStockCode(parsedData);-->
<!--      renderChart(filteredData);-->
<!--    </script>-->
</body>
</html>
